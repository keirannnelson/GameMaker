{% extends "layout.html" %}
{% block title %}Prediction - Game Maker{% endblock %}

{% block content %}

  
    <div style="display: flex; flex-direction: column; gap: 1em;">
<div class="main-content" style="font-family: 'Montserrat', sans-serif; display: flex; flex-direction: column; align-items: center; gap: 2em; margin-top: 2em;">

  <!-- Input section -->
<div style="display: flex; flex-direction: column; gap: 1em;">
    <label for="start-date" style="font-weight: 600;">Start Date</label>
    <input 
      type="date" 
      id="start-date"
      style="padding: 10px; font-size: 1em; border: 1px solid #ccc; border-radius: 4px;"
      required
    >

    <label for="end-date" style="font-weight: 600;">End Date (max 5 days later)</label>
    <input 
      type="date" 
      id="end-date"
      style="padding: 10px; font-size: 1em; border: 1px solid #ccc; border-radius: 4px;"
      required
    >

<button type="button" onclick="retrieveGamesRange()" style="
  padding: 10px 16px;
  background-color: #1D428A;
  color: white;
  font-weight: 600;
  border: none;
  border-radius: 4px;
  cursor: pointer;
">
  RETRIEVE
</button>

     <button type="button" onclick="predictGames()" style="
  padding: 10px 16px;
  background-color: #1D428A;
  color: white;
  font-weight: 600;
  border: none;
  border-radius: 4px;
  cursor: pointer;
">
  PREDICT
</button>


<!-- Game output goes here -->
<div id="games-table-container" style="margin-top:30px; max-height: 400px; overflow-y: auto;"></div>


<script>
  function retrieveGamesRange() {
    const startDateStr = document.getElementById('start-date').value;
    const endDateStr = document.getElementById('end-date').value;

    if (!startDateStr || !endDateStr) {
      alert('Please select both start and end dates.');
      return;
    }

    const startDate = new Date(startDateStr);
    const endDate = new Date(endDateStr);

    if (endDate < startDate) {
      alert('End date cannot be before start date.');
      return;
    }

    const diffDays = (endDate - startDate) / (1000 * 3600 * 24) + 1;

    if (diffDays > 5) {
      alert('Date range cannot be more than 5 days.');
      return;
    }

    const dates = [];
    for (let i = 0; i < diffDays; i++) {
      const d = new Date(startDate);
      d.setDate(startDate.getDate() + i);
      dates.push(d.toISOString().slice(0, 10));
    }

    fetch('/get_games_range', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ selected_dates: dates })
    })
    .then(res => res.json())
    .then(data => {
      const container = document.getElementById('games-table-container');
      if (!data.games || Object.keys(data.games).length === 0) {
        container.innerHTML = '<p>No games found for this date range.</p>';
        return;
      }

      container.innerHTML = '';

      for (const [date, games] of Object.entries(data.games)) {
        container.innerHTML += `<h3 style="margin-top: 20px; font-weight: 600;">Games on ${date}</h3>`;

        let tableHTML = `
          <table style="
            width: 100%;
            border-collapse: collapse;
            font-family: 'Montserrat', sans-serif;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
          ">
            <thead>
              <tr style="background-color: #1D428A; color: white;">
                <th style="padding: 12px; border: 1px solid #ddd;">Home</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Home W–L</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Away</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Away W–L</th>
              </tr>
            </thead>
            <tbody>
        `;

        games.forEach(game => {
          tableHTML += `
            <tr style="background-color: #f9f9f9;">
              <td style="padding: 12px; border: 1px solid #ddd;">${game.team1}</td>
              <td style="padding: 12px; border: 1px solid #ddd;">${game.team1_record}</td>
              <td style="padding: 12px; border: 1px solid #ddd;">${game.team2}</td>
              <td style="padding: 12px; border: 1px solid #ddd;">${game.team2_record}</td>
            </tr>
          `;
        });

        tableHTML += '</tbody></table>';
        container.innerHTML += tableHTML;
      }
    })
    .catch(err => {
      console.error(err);
      alert('Failed to retrieve games.');
    });
    
  }
  
</script>

{% endblock %}

